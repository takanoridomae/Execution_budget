# 🛡️ 新しいFirebaseプロジェクト「execution-budget」セキュリティルール設定

## 📋 プロジェクト情報
- **プロジェクトID**: `execution-budget`
- **ストレージバケット**: `execution-budget.firebasestorage.app`
- **状況**: アプリ接続設定完了 ✅

## 🔧 次に設定が必要なセキュリティルール

### 1. Firebase Storage セキュリティルール

Firebase Console → **Storage** → **Rules** タブで以下を設定：

```javascript
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // 取引画像の保存・読み取り
    match /transactions/{transactionId}/images/{imageId} {
      // 読み取り: 全ユーザー許可（デモアプリのため）
      allow read: if true;
      
      // 書き込み: ファイル制限付きで許可
      allow write: if request.resource != null
        && request.resource.size < 10 * 1024 * 1024  // 10MB以下
        && request.resource.contentType.matches('image/.*') // 画像ファイルのみ
        && transactionId.matches('[a-zA-Z0-9]+'); // 英数字のIDのみ
    }
    
    // 接続テスト用（自動削除される）
    match /test/{testFile} {
      allow read, write: if true;
    }
    
    // その他のパスはアクセス拒否
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
```

### 2. Firestore Database セキュリティルール

Firebase Console → **Firestore Database** → **ルール** タブで以下を設定：

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // 取引データ: 読み書き許可（デモアプリのため）
    match /transactions/{transactionId} {
      allow read, write: if true;
    }
    
    // 予算設定データ: 読み書き許可
    match /budgetSettings/{settingId} {
      allow read, write: if true;
    }
    
    // その他のデータはアクセス拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

## 🎯 設定手順

### Firebase Storage セキュリティルール設定

1. [Firebase Console](https://console.firebase.google.com/) にアクセス
2. プロジェクト **「execution-budget」** を選択
3. 左メニューから **「Storage」** を選択
4. **「Rules」** タブをクリック
5. 上記のStorageルールをコピー＆ペースト
6. **「公開」** ボタンをクリック

### Firestore Database セキュリティルール設定

1. 同じFirebase Consoleで
2. 左メニューから **「Firestore Database」** を選択
3. **「ルール」** タブをクリック
4. 上記のFirestoreルールをコピー＆ペースト
5. **「公開」** ボタンをクリック

## ✅ 設定完了の確認方法

### 1. アプリケーションの起動確認

```bash
npm start
```

コンソールで以下が表示されることを確認：
```
🔧 Firebase初期化完了: {
  projectId: "execution-budget", 
  storageBucket: "execution-budget.firebasestorage.app", 
  authDomain: "execution-budget.firebaseapp.com"
}
```

### 2. Firebase Storage接続テスト

ブラウザのデベロッパーツールのコンソールで：
```
🔍 Firebase Storage接続テスト中...
✅ Firebase Storage接続成功
☁️ Firebase Storage優先モード（Blazeプラン・デバイス間同期対応）
```

### 3. 画像保存テスト

1. 取引を追加
2. 画像を添付
3. 保存時のメッセージ確認：
   ```
   💾 取引を保存しました (クラウド保存・デバイス間同期対応)
   ```

## 🚀 完了後の利点

✅ **新しい専用プロジェクト**での独立運用  
✅ **デバイス間での画像同期**  
✅ **10MBまでの高品質画像対応**  
✅ **既存プロジェクトからの完全分離**  
✅ **安全なセキュリティルール適用**

## 💰 想定コスト

月額使用量目安：
- **Storage**: ¥26-52 (1-2GB)
- **転送量**: ¥60 (0.5GB)
- **Firestore**: ¥14 (読み書き操作)
- **合計**: **¥100-150/月**

設定完了後、アプリが新しいプロジェクトで正常に動作することをご確認ください！
